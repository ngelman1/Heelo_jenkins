// Jenkinsfile - Part 4: Environment Variables

pipeline {
    agent any

    // 'environment' block: Defines environment variables accessible throughout the pipeline.
    environment {
        // Define a simple variable
        APP_VERSION = '1.0.0'
        BUILD_IDENTIFIER = "#${env.BUILD_NUMBER}" // 'env' is a built-in object for env vars
    }

    stages {
        stage('Build') {
            steps {
                echo "Building application version: ${env.APP_VERSION}"
                echo "Build ID: ${env.BUILD_IDENTIFIER}"
                sh 'echo "Simulating compilation for ${APP_VERSION}"'
            }
        }
        stage('Test') {
            steps {
                echo 'Running tests...'
                sh 'echo "Running tests with BUILD_IDENTIFIER: ${BUILD_IDENTIFIER}"'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Initiating deployment...'
                sh "echo 'Deploying version ${APP_VERSION} to environment ${env.BUILD_IDENTIFIER}'"
            }
        }
    }

    post {
        always {
            echo 'Pipeline finished.'
        }
    }
}